<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>DoSomething.org: Update versions of API functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Update versions of API functions</h1><table border="0" cellpadding="0" cellspacing="0">
</table>
<p>End of "addtogroup callbacks".</p>
<p>Functions that are similar to normal API functions, but do not invoke hooks.</p>
<p>These simplified versions of core API functions are provided for use by update functions (<a class="el" href="group__hooks.html#ga908950689e6b85cd0fae3b780d69a41f">hook_update_N()</a> implementations).</p>
<p>During database updates the schema of any module could be out of date. For this reason, caution is needed when using any API function within an update function - particularly CRUD functions, functions that depend on the schema (for example by using <a class="el" href="group__schemaapi.html#ga96f707de751a962bf21b6cb0cb4f2ae6">drupal_write_record()</a>), and any functions that invoke hooks.</p>
<p>Instead, a simplified utility function should be used. If a utility version of the API function you require does not already exist, then you should create a new function. The new utility function should be named _update_N_mymodule_my_function(). N is the schema version the function acts on (the schema version is the number N from the <a class="el" href="group__hooks.html#ga908950689e6b85cd0fae3b780d69a41f">hook_update_N()</a> implementation where this schema was introduced, or a number following the same numbering scheme), and mymodule_my_function is the name of the original API function including the module's name.</p>
<p>Examples:</p>
<ul>
<li>_update_6000_mymodule_save(): This function performs a save operation without invoking any hooks using the 6.x schema.</li>
<li>_update_7000_mymodule_save(): This function performs the same save operation using the 7.x schema.</li>
</ul>
<p>The utility function should not invoke any hooks, and should perform database operations using functions from the <a class="el" href="group__database.html">Database abstraction layer, </a> like <a class="el" href="group__database.html#gaadfbffaf30ff5eb14f1bd88619351345">db_insert()</a>, <a class="el" href="group__database.html#ga40967197ee5d6a23a5c5a77e627067fe">db_update()</a>, <a class="el" href="group__database.html#ga72f0ccecc0ba181de16c6e3451150f2c">db_delete()</a>, <a class="el" href="group__database.html#gafa3b6cb2b2f61479cc63a4150c62da9b">db_query()</a>, and so on.</p>
<p>If a change to the schema necessitates a change to the utility function, a new function should be created with a name based on the version of the schema it acts on. See _update_7000_bar_get_types() and _update_7001_bar_get_types() in the code examples that follow.</p>
<p>For example, foo.install could contain: </p>
<div class="fragment"><pre class="fragment"> function foo_update_dependencies() {
   <span class="comment">// foo_update_7010() needs to run after bar_update_7000().</span>
   $dependencies[<span class="stringliteral">&apos;foo&apos;</span>][7010] = array(
     <span class="stringliteral">&apos;bar&apos;</span> =&gt; 7000,
   );

   <span class="comment">// foo_update_7036() needs to run after bar_update_7001().</span>
   $dependencies[<span class="stringliteral">&apos;foo&apos;</span>][7036] = array(
     <span class="stringliteral">&apos;bar&apos;</span> =&gt; 7001,
   );

   <span class="keywordflow">return</span> $dependencies;
 }

 function foo_update_7000() {
   <span class="comment">// No updates have been run on the {bar_types} table yet, so this needs</span>
   <span class="comment">// to work with the 6.x schema.</span>
   <span class="keywordflow">foreach</span> (_update_6000_bar_get_types() as $type) {
     <span class="comment">// Rename a variable.</span>
   }
 }

 function foo_update_7010() {
    <span class="comment">// Since foo_update_7010() is going to run after bar_update_7000(), it</span>
    <span class="comment">// needs to operate on the new schema, not the old one.</span>
    <span class="keywordflow">foreach</span> (_update_7000_bar_get_types() as $type) {
      <span class="comment">// Rename a different variable.</span>
    }
 }

 function foo_update_7036() {
   <span class="comment">// This update will run after bar_update_7001().</span>
   <span class="keywordflow">foreach</span> (_update_7001_bar_get_types() as $type) {
   }
 }
</pre></div><p>And bar.install could contain: </p>
<div class="fragment"><pre class="fragment"> function bar_update_7000() {
   <span class="comment">// Type and bundle are confusing, so we renamed the table.</span>
   <a class="code" href="group__schemaapi.html#ga629fe4d738f4caeb9d8c8acc2cc4d05b">db_rename_table</a>(<span class="stringliteral">&apos;bar_types&apos;</span>, <span class="stringliteral">&apos;bar_bundles&apos;</span>);
 }

 function bar_update_7001() {
   <span class="comment">// Database table names should be singular when possible.</span>
   <a class="code" href="group__schemaapi.html#ga629fe4d738f4caeb9d8c8acc2cc4d05b">db_rename_table</a>(<span class="stringliteral">&apos;bar_bundles&apos;</span>, <span class="stringliteral">&apos;bar_bundle&apos;</span>);
 }

 function _update_6000_bar_get_types() {
   <a class="code" href="group__database.html#gafa3b6cb2b2f61479cc63a4150c62da9b">db_query</a>(<span class="stringliteral">&apos;SELECT * FROM {bar_types}&apos;</span>)-&gt;fetchAll();
 }

 function _update_7000_bar_get_types() {
   <a class="code" href="group__database.html#gafa3b6cb2b2f61479cc63a4150c62da9b">db_query</a>(<span class="stringliteral">&apos;SELECT * FROM {bar_bundles&apos;</span>})-&gt;fetchAll();
 }

 function _update_7001_bar_get_types() {
   <a class="code" href="group__database.html#gafa3b6cb2b2f61479cc63a4150c62da9b">db_query</a>(<span class="stringliteral">&apos;SELECT * FROM {bar_bundle}&apos;</span>)-&gt;fetchAll();
 }
</pre></div><dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__hooks.html#ga908950689e6b85cd0fae3b780d69a41f">hook_update_N()</a> </dd>
<dd>
<a class="el" href="group__hooks.html#ga23e9e019b7ec64d95bafbeaffd295483">hook_update_dependencies()</a> </dd></dl>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 8 Nov 2013 for DoSomething.org by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
