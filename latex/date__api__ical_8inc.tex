\hypertarget{date__api__ical_8inc}{
\section{html/profiles/dosomething/modules/contrib/date/date\_\-api/date\_\-api\_\-ical.inc File Reference}
\label{date__api__ical_8inc}\index{html/profiles/dosomething/modules/contrib/date/date\_\-api/date\_\-api\_\-ical.inc@{html/profiles/dosomething/modules/contrib/date/date\_\-api/date\_\-api\_\-ical.inc}}
}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{date__api__ical_8inc_a9c32ef84b7717c5f5b9333a14aab9e17}{date\_\-ical\_\-import} (\$filename)
\item 
\hyperlink{date__api__ical_8inc_af4aa5783fc7056e99b6e0fc0d981cda4}{date\_\-ical\_\-parse} (\$icaldatafolded=array())
\item 
\hyperlink{date__api__ical_8inc_a043a6a7b1c9724a27cd16750f01492c4}{date\_\-ical\_\-parse\_\-date} (\$field, \$data)
\item 
\hyperlink{date__api__ical_8inc_adaf397fd219714e7a7fd430e179ee592}{date\_\-ical\_\-parse\_\-rrule} (\$field, \$data)
\item 
\hyperlink{date__api__ical_8inc_a6f1c803e50f78faab69c8348c1dd8c1f}{date\_\-ical\_\-parse\_\-exceptions} (\$field, \$data)
\item 
\hyperlink{date__api__ical_8inc_a8a63c8aa2158e701b01217637169440d}{date\_\-ical\_\-parse\_\-duration} (\&\$subgroup, \$field= 'DURATION')
\item 
\hyperlink{date__api__ical_8inc_ae0b819676bd9cec8f5a6a8d71b82c117}{date\_\-ical\_\-parse\_\-text} (\$field, \$data)
\item 
\hyperlink{date__api__ical_8inc_a28db1e5fc29fc45ff15e1bdab89235d5}{date\_\-ical\_\-parse\_\-location} (\$field, \$data)
\item 
\hyperlink{date__api__ical_8inc_a8b0b84eff1d472110d9152574b1b390e}{date\_\-ical\_\-date} (\$ical\_\-date, \$to\_\-tz=FALSE)
\item 
\hyperlink{date__api__ical_8inc_af17a30f380d9be0902300cd7bfc5eaa0}{date\_\-ical\_\-escape\_\-text} (\$text)
\item 
\hyperlink{date__api__ical_8inc_ad49735896adc89955afb8e8df6d16b51}{date\_\-api\_\-ical\_\-build\_\-rrule} (\$form\_\-values)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Parse iCal data.

This file must be included when these functions are needed. 

\subsection{Function Documentation}
\hypertarget{date__api__ical_8inc_ad49735896adc89955afb8e8df6d16b51}{
\index{date\_\-api\_\-ical.inc@{date\_\-api\_\-ical.inc}!date\_\-api\_\-ical\_\-build\_\-rrule@{date\_\-api\_\-ical\_\-build\_\-rrule}}
\index{date\_\-api\_\-ical\_\-build\_\-rrule@{date\_\-api\_\-ical\_\-build\_\-rrule}!date_api_ical.inc@{date\_\-api\_\-ical.inc}}
\subsubsection[{date\_\-api\_\-ical\_\-build\_\-rrule}]{\setlength{\rightskip}{0pt plus 5cm}date\_\-api\_\-ical\_\-build\_\-rrule (\$ {\em form\_\-values})}}
\label{date__api__ical_8inc_ad49735896adc89955afb8e8df6d16b51}
Build an iCal RULE from \$form\_\-values.


\begin{DoxyParams}{Parameters}
\item[{\em array}]\$form\_\-values An array constructed like the one created by \hyperlink{date__api__ical_8inc_adaf397fd219714e7a7fd430e179ee592}{date\_\-ical\_\-parse\_\-rrule()}. \mbox{[}RRULE\mbox{]} =$>$ Array ( \mbox{[}FREQ\mbox{]} =$>$ Array ( \mbox{[}0\mbox{]} =$>$ MONTHLY ) \mbox{[}BYDAY\mbox{]} =$>$ Array ( \mbox{[}0\mbox{]} =$>$ 1SU \mbox{[}1\mbox{]} =$>$ -\/1SU ) \mbox{[}UNTIL\mbox{]} =$>$ Array ( \mbox{[}datetime\mbox{]} =$>$ 1997-\/21-\/31 09:00:00 \mbox{[}all\_\-day\mbox{]} =$>$ 0 \mbox{[}tz\mbox{]} =$>$ US/Eastern ) ) \mbox{[}EXDATE\mbox{]} =$>$ Array ( \mbox{[}0\mbox{]} = Array ( \mbox{[}datetime\mbox{]} =$>$ 1997-\/09-\/21 09:00:00 \mbox{[}all\_\-day\mbox{]} =$>$ 0 \mbox{[}tz\mbox{]} =$>$ US/Eastern ) \mbox{[}1\mbox{]} = Array ( \mbox{[}datetime\mbox{]} =$>$ 1997-\/10-\/05 09:00:00 \mbox{[}all\_\-day\mbox{]} =$>$ 0 \mbox{[}tz\mbox{]} =$>$ US/Eastern ) ) \mbox{[}RDATE\mbox{]} =$>$ Array ( \mbox{[}0\mbox{]} = Array ( \mbox{[}datetime\mbox{]} =$>$ 1997-\/09-\/21 09:00:00 \mbox{[}all\_\-day\mbox{]} =$>$ 0 \mbox{[}tz\mbox{]} =$>$ US/Eastern ) \mbox{[}1\mbox{]} = Array ( \mbox{[}datetime\mbox{]} =$>$ 1997-\/10-\/05 09:00:00 \mbox{[}all\_\-day\mbox{]} =$>$ 0 \mbox{[}tz\mbox{]} =$>$ US/Eastern ) ) \end{DoxyParams}
\hypertarget{date__api__ical_8inc_a8b0b84eff1d472110d9152574b1b390e}{
\index{date\_\-api\_\-ical.inc@{date\_\-api\_\-ical.inc}!date\_\-ical\_\-date@{date\_\-ical\_\-date}}
\index{date\_\-ical\_\-date@{date\_\-ical\_\-date}!date_api_ical.inc@{date\_\-api\_\-ical.inc}}
\subsubsection[{date\_\-ical\_\-date}]{\setlength{\rightskip}{0pt plus 5cm}date\_\-ical\_\-date (\$ {\em ical\_\-date}, \/  \$ {\em to\_\-tz} = {\ttfamily FALSE})}}
\label{date__api__ical_8inc_a8b0b84eff1d472110d9152574b1b390e}
Return a date object for the ical date, adjusted to its local timezone.


\begin{DoxyParams}{Parameters}
\item[{\em array}]\$ical\_\-date An array of ical date information created in the ical import. \item[{\em string}]\$to\_\-tz The timezone to convert the date's value to.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
object A timezone-\/adjusted date object. 
\end{DoxyReturn}
\hypertarget{date__api__ical_8inc_af17a30f380d9be0902300cd7bfc5eaa0}{
\index{date\_\-api\_\-ical.inc@{date\_\-api\_\-ical.inc}!date\_\-ical\_\-escape\_\-text@{date\_\-ical\_\-escape\_\-text}}
\index{date\_\-ical\_\-escape\_\-text@{date\_\-ical\_\-escape\_\-text}!date_api_ical.inc@{date\_\-api\_\-ical.inc}}
\subsubsection[{date\_\-ical\_\-escape\_\-text}]{\setlength{\rightskip}{0pt plus 5cm}date\_\-ical\_\-escape\_\-text (\$ {\em text})}}
\label{date__api__ical_8inc_af17a30f380d9be0902300cd7bfc5eaa0}
Escape text elements for safe iCal use.


\begin{DoxyParams}{Parameters}
\item[{\em string}]\$text Text to escape\end{DoxyParams}
\begin{DoxyReturn}{Returns}
string Escaped text 
\end{DoxyReturn}
\hypertarget{date__api__ical_8inc_a9c32ef84b7717c5f5b9333a14aab9e17}{
\index{date\_\-api\_\-ical.inc@{date\_\-api\_\-ical.inc}!date\_\-ical\_\-import@{date\_\-ical\_\-import}}
\index{date\_\-ical\_\-import@{date\_\-ical\_\-import}!date_api_ical.inc@{date\_\-api\_\-ical.inc}}
\subsubsection[{date\_\-ical\_\-import}]{\setlength{\rightskip}{0pt plus 5cm}date\_\-ical\_\-import (\$ {\em filename})}}
\label{date__api__ical_8inc_a9c32ef84b7717c5f5b9333a14aab9e17}
Return an array of iCalendar information from an iCalendar file.

No timezone adjustment is performed in the import since the timezone conversion needed will vary depending on whether the value is being imported into the database (when it needs to be converted to UTC), is being viewed on a site that has user-\/configurable timezones (when it needs to be converted to the user's timezone), if it needs to be converted to the site timezone, or if it is a date without a timezone which should not have any timezone conversion applied.

Properties that have dates and times are converted to sub-\/arrays like: 'datetime' =$>$ date in YYYY-\/MM-\/DD HH:MM format, not timezone adjusted 'all\_\-day' =$>$ whether this is an all-\/day event 'tz' =$>$ the timezone of the date, could be blank for absolute times that should get no timezone conversion.

Exception dates can have muliple values and are returned as arrays like the above for each exception date.

Most other properties are returned as PROPERTY =$>$ VALUE.

Each item in the VCALENDAR will return an array like: \mbox{[}0\mbox{]} =$>$ Array ( \mbox{[}TYPE\mbox{]} =$>$ VEVENT \mbox{[}UID\mbox{]} =$>$ 104 \mbox{[}SUMMARY\mbox{]} =$>$ An example event \mbox{[}URL\mbox{]} =$>$ \href{http://example.com/node/1}{\tt http://example.com/node/1} \mbox{[}DTSTART\mbox{]} =$>$ Array ( \mbox{[}datetime\mbox{]} =$>$ 1997-\/09-\/07 09:00:00 \mbox{[}all\_\-day\mbox{]} =$>$ 0 \mbox{[}tz\mbox{]} =$>$ US/Eastern ) \mbox{[}DTEND\mbox{]} =$>$ Array ( \mbox{[}datetime\mbox{]} =$>$ 1997-\/09-\/07 11:00:00 \mbox{[}all\_\-day\mbox{]} =$>$ 0 \mbox{[}tz\mbox{]} =$>$ US/Eastern ) \mbox{[}RRULE\mbox{]} =$>$ Array ( \mbox{[}FREQ\mbox{]} =$>$ Array ( \mbox{[}0\mbox{]} =$>$ MONTHLY ) \mbox{[}BYDAY\mbox{]} =$>$ Array ( \mbox{[}0\mbox{]} =$>$ 1SU \mbox{[}1\mbox{]} =$>$ -\/1SU ) ) \mbox{[}EXDATE\mbox{]} =$>$ Array ( \mbox{[}0\mbox{]} = Array ( \mbox{[}datetime\mbox{]} =$>$ 1997-\/09-\/21 09:00:00 \mbox{[}all\_\-day\mbox{]} =$>$ 0 \mbox{[}tz\mbox{]} =$>$ US/Eastern ) \mbox{[}1\mbox{]} = Array ( \mbox{[}datetime\mbox{]} =$>$ 1997-\/10-\/05 09:00:00 \mbox{[}all\_\-day\mbox{]} =$>$ 0 \mbox{[}tz\mbox{]} =$>$ US/Eastern ) ) \mbox{[}RDATE\mbox{]} =$>$ Array ( \mbox{[}0\mbox{]} = Array ( \mbox{[}datetime\mbox{]} =$>$ 1997-\/09-\/21 09:00:00 \mbox{[}all\_\-day\mbox{]} =$>$ 0 \mbox{[}tz\mbox{]} =$>$ US/Eastern ) \mbox{[}1\mbox{]} = Array ( \mbox{[}datetime\mbox{]} =$>$ 1997-\/10-\/05 09:00:00 \mbox{[}all\_\-day\mbox{]} =$>$ 0 \mbox{[}tz\mbox{]} =$>$ US/Eastern ) ) )

\begin{Desc}
\item[\hyperlink{todo__todo000021}{Todo}]figure out how to handle this if subgroups are nested, like a VALARM nested inside a VEVENT.\end{Desc}

\begin{DoxyParams}{Parameters}
\item[{\em string}]\$filename Location (local or remote) of a valid iCalendar file.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
array An array with all the elements from the ical. 
\end{DoxyReturn}
\hypertarget{date__api__ical_8inc_af4aa5783fc7056e99b6e0fc0d981cda4}{
\index{date\_\-api\_\-ical.inc@{date\_\-api\_\-ical.inc}!date\_\-ical\_\-parse@{date\_\-ical\_\-parse}}
\index{date\_\-ical\_\-parse@{date\_\-ical\_\-parse}!date_api_ical.inc@{date\_\-api\_\-ical.inc}}
\subsubsection[{date\_\-ical\_\-parse}]{\setlength{\rightskip}{0pt plus 5cm}date\_\-ical\_\-parse (\$ {\em icaldatafolded} = {\ttfamily array()})}}
\label{date__api__ical_8inc_af4aa5783fc7056e99b6e0fc0d981cda4}
Returns an array of iCalendar information from an iCalendar file.

As \hyperlink{date__api__ical_8inc_a9c32ef84b7717c5f5b9333a14aab9e17}{date\_\-ical\_\-import()} but different param.


\begin{DoxyParams}{Parameters}
\item[{\em array}]\$icaldatafolded An array of lines from an ical feed.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
array An array with all the elements from the ical. 
\end{DoxyReturn}
\hypertarget{date__api__ical_8inc_a043a6a7b1c9724a27cd16750f01492c4}{
\index{date\_\-api\_\-ical.inc@{date\_\-api\_\-ical.inc}!date\_\-ical\_\-parse\_\-date@{date\_\-ical\_\-parse\_\-date}}
\index{date\_\-ical\_\-parse\_\-date@{date\_\-ical\_\-parse\_\-date}!date_api_ical.inc@{date\_\-api\_\-ical.inc}}
\subsubsection[{date\_\-ical\_\-parse\_\-date}]{\setlength{\rightskip}{0pt plus 5cm}date\_\-ical\_\-parse\_\-date (\$ {\em field}, \/  \$ {\em data})}}
\label{date__api__ical_8inc_a043a6a7b1c9724a27cd16750f01492c4}
Parses a ical date element.

Possible formats to parse include: PROPERTY:YYYYMMDD\mbox{[}T\mbox{]}\mbox{[}HH\mbox{]}\mbox{[}MM\mbox{]}\mbox{[}SS\mbox{]}\mbox{[}Z\mbox{]} PROPERTY;VALUE=DATE:YYYYMMDD\mbox{[}T\mbox{]}\mbox{[}HH\mbox{]}\mbox{[}MM\mbox{]}\mbox{[}SS\mbox{]}\mbox{[}Z\mbox{]} PROPERTY;VALUE=DATE-\/TIME:YYYYMMDD\mbox{[}T\mbox{]}\mbox{[}HH\mbox{]}\mbox{[}MM\mbox{]}\mbox{[}SS\mbox{]}\mbox{[}Z\mbox{]} PROPERTY;TZID=XXXXXXXX;VALUE=DATE:YYYYMMDD\mbox{[}T\mbox{]}\mbox{[}HH\mbox{]}\mbox{[}MM\mbox{]}\mbox{[}SS\mbox{]} PROPERTY;TZID=XXXXXXXX:YYYYMMDD\mbox{[}T\mbox{]}\mbox{[}HH\mbox{]}\mbox{[}MM\mbox{]}\mbox{[}SS\mbox{]}

The property and the colon before the date are removed in the import process above and we are left with \$field and \$data.


\begin{DoxyParams}{Parameters}
\item[{\em string}]\$field The text before the colon and the date, i.e. ';VALUE=DATE:', ';VALUE=DATE-\/TIME:', ';TZID=' \item[{\em string}]\$data The date itself, after the colon, in the format YYYYMMDD\mbox{[}T\mbox{]}\mbox{[}HH\mbox{]}\mbox{[}MM\mbox{]}\mbox{[}SS\mbox{]}\mbox{[}Z\mbox{]} 'Z', if supplied, means the date is in UTC.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
array \$items array, consisting of: 'datetime' =$>$ date in YYYY-\/MM-\/DD HH:MM format, not timezone adjusted 'all\_\-day' =$>$ whether this is an all-\/day event with no time 'tz' =$>$ the timezone of the date, could be blank if the ical has no timezone; the ical specs say no timezone conversion should be done if no timezone info is supplied 
\end{DoxyReturn}
\begin{Desc}
\item[\hyperlink{todo__todo000022}{Todo}]Another option for dates is the format PROPERTY;VALUE=PERIOD:XXXX. The period may include a duration, or a date and a duration, or two dates, so would have to be split into parts and run through \hyperlink{date__api__ical_8inc_a043a6a7b1c9724a27cd16750f01492c4}{date\_\-ical\_\-parse\_\-date()} and \hyperlink{date__api__ical_8inc_a8a63c8aa2158e701b01217637169440d}{date\_\-ical\_\-parse\_\-duration()}. This is not commonly used, so ignored for now. It will take more work to figure how to support that. \end{Desc}
\hypertarget{date__api__ical_8inc_a8a63c8aa2158e701b01217637169440d}{
\index{date\_\-api\_\-ical.inc@{date\_\-api\_\-ical.inc}!date\_\-ical\_\-parse\_\-duration@{date\_\-ical\_\-parse\_\-duration}}
\index{date\_\-ical\_\-parse\_\-duration@{date\_\-ical\_\-parse\_\-duration}!date_api_ical.inc@{date\_\-api\_\-ical.inc}}
\subsubsection[{date\_\-ical\_\-parse\_\-duration}]{\setlength{\rightskip}{0pt plus 5cm}date\_\-ical\_\-parse\_\-duration (\&\$ {\em subgroup}, \/  \$ {\em field} = {\ttfamily 'DURATION'})}}
\label{date__api__ical_8inc_a8a63c8aa2158e701b01217637169440d}
Parses the duration of the event.

Example: DURATION:PT1H30M DURATION:P1Y2M


\begin{DoxyParams}{Parameters}
\item[{\em array}]\$subgroup Array of other values in the vevent so we can check for DTSTART. \end{DoxyParams}
\hypertarget{date__api__ical_8inc_a6f1c803e50f78faab69c8348c1dd8c1f}{
\index{date\_\-api\_\-ical.inc@{date\_\-api\_\-ical.inc}!date\_\-ical\_\-parse\_\-exceptions@{date\_\-ical\_\-parse\_\-exceptions}}
\index{date\_\-ical\_\-parse\_\-exceptions@{date\_\-ical\_\-parse\_\-exceptions}!date_api_ical.inc@{date\_\-api\_\-ical.inc}}
\subsubsection[{date\_\-ical\_\-parse\_\-exceptions}]{\setlength{\rightskip}{0pt plus 5cm}date\_\-ical\_\-parse\_\-exceptions (\$ {\em field}, \/  \$ {\em data})}}
\label{date__api__ical_8inc_a6f1c803e50f78faab69c8348c1dd8c1f}
Parse exception dates (can be multiple values).

\begin{DoxyReturn}{Returns}
array an array of date value arrays. 
\end{DoxyReturn}
\hypertarget{date__api__ical_8inc_a28db1e5fc29fc45ff15e1bdab89235d5}{
\index{date\_\-api\_\-ical.inc@{date\_\-api\_\-ical.inc}!date\_\-ical\_\-parse\_\-location@{date\_\-ical\_\-parse\_\-location}}
\index{date\_\-ical\_\-parse\_\-location@{date\_\-ical\_\-parse\_\-location}!date_api_ical.inc@{date\_\-api\_\-ical.inc}}
\subsubsection[{date\_\-ical\_\-parse\_\-location}]{\setlength{\rightskip}{0pt plus 5cm}date\_\-ical\_\-parse\_\-location (\$ {\em field}, \/  \$ {\em data})}}
\label{date__api__ical_8inc_a28db1e5fc29fc45ff15e1bdab89235d5}
Parse location elements.

Catch situations like the upcoming.org feed that uses LOCATION;VENUE-\/UID=\char`\"{}http://upcoming.yahoo.com/venue/104/\char`\"{}:111 First Street... or more normal LOCATION;UID=123:111 First Street... Upcoming feed would have been improperly broken on the ':' in \href{http://}{\tt http://} so we paste the \$field and \$data back together first.

Use non-\/greedy check for ':' in case there are more of them in the address. \hypertarget{date__api__ical_8inc_adaf397fd219714e7a7fd430e179ee592}{
\index{date\_\-api\_\-ical.inc@{date\_\-api\_\-ical.inc}!date\_\-ical\_\-parse\_\-rrule@{date\_\-ical\_\-parse\_\-rrule}}
\index{date\_\-ical\_\-parse\_\-rrule@{date\_\-ical\_\-parse\_\-rrule}!date_api_ical.inc@{date\_\-api\_\-ical.inc}}
\subsubsection[{date\_\-ical\_\-parse\_\-rrule}]{\setlength{\rightskip}{0pt plus 5cm}date\_\-ical\_\-parse\_\-rrule (\$ {\em field}, \/  \$ {\em data})}}
\label{date__api__ical_8inc_adaf397fd219714e7a7fd430e179ee592}
Parse an ical repeat rule.

\begin{DoxyReturn}{Returns}
array Array in the form of PROPERTY =$>$ array(VALUES) PROPERTIES include FREQ, INTERVAL, COUNT, BYDAY, BYMONTH, BYYEAR, UNTIL 
\end{DoxyReturn}
\hypertarget{date__api__ical_8inc_ae0b819676bd9cec8f5a6a8d71b82c117}{
\index{date\_\-api\_\-ical.inc@{date\_\-api\_\-ical.inc}!date\_\-ical\_\-parse\_\-text@{date\_\-ical\_\-parse\_\-text}}
\index{date\_\-ical\_\-parse\_\-text@{date\_\-ical\_\-parse\_\-text}!date_api_ical.inc@{date\_\-api\_\-ical.inc}}
\subsubsection[{date\_\-ical\_\-parse\_\-text}]{\setlength{\rightskip}{0pt plus 5cm}date\_\-ical\_\-parse\_\-text (\$ {\em field}, \/  \$ {\em data})}}
\label{date__api__ical_8inc_ae0b819676bd9cec8f5a6a8d71b82c117}
Parse and clean up ical text elements. 