\hypertarget{group__field__purge}{
\section{Field API bulk data deletion}
\label{group__field__purge}\index{Field API bulk data deletion@{Field API bulk data deletion}}
}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group__field__purge_gac0dcacb53338e25ac4e2add6b427757e}{field\_\-purge\_\-batch} (\$batch\_\-size)
\item 
\hyperlink{group__field__purge_ga93ec2f273b56141a5079bfaf25d6b80e}{field\_\-purge\_\-data} (\$entity\_\-type, \$entity, \$field, \$instance)
\item 
\hyperlink{group__field__purge_ga766cee439c7c920d3d406c7af41c8968}{field\_\-purge\_\-instance} (\$instance)
\item 
\hyperlink{group__field__purge_gac52122a65da997921f3a6a8f45deddbf}{field\_\-purge\_\-field} (\$field)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
End of \char`\"{}defgroup field\_\-crud\char`\"{}.

Clean up after Field API bulk deletion operations.

Field API provides functions for deleting data attached to individual entities as well as deleting entire fields or field instances in a single operation.

Deleting field data items for an entity with \hyperlink{group__field__attach_gac2e3658c9c02d0d0e71359f9ef2f207a}{field\_\-attach\_\-delete()} involves three separate operations:
\begin{DoxyItemize}
\item Invoking the Field Type API \hyperlink{group__field__types_gaf1e5787044b83d34cf7daed3d5297336}{hook\_\-field\_\-delete()} for each field on the entity. The hook for each field type receives the entity and the specific field being deleted. A file field module might use this hook to delete uploaded files from the filesystem.
\item Invoking the Field Storage API \hyperlink{group__field__storage_ga64bd5adc0e4ccc1fe52fbaabcfa10274}{hook\_\-field\_\-storage\_\-delete()} to remove data from the primary field storage. The hook implementation receives the entity being deleted and deletes data for all of the entity's bundle's fields.
\item Invoking the global Field Attach API \hyperlink{group__field__attach_gac9e5a9e43f1290315db8b593b9516094}{hook\_\-field\_\-attach\_\-delete()} for all modules that implement it. Each hook implementation receives the entity being deleted and can operate on whichever subset of the entity's bundle's fields it chooses to.
\end{DoxyItemize}

These hooks are invoked immediately when \hyperlink{group__field__attach_gac2e3658c9c02d0d0e71359f9ef2f207a}{field\_\-attach\_\-delete()} is called. Similar operations are performed for \hyperlink{group__field__attach_gaa9eae65e6d9f1996cb27a55ba25b56e9}{field\_\-attach\_\-delete\_\-revision()}.

When a field, bundle, or field instance is deleted, it is not practical to invoke these hooks immediately on every affected entity in a single page request; there could be thousands or millions of them. Instead, the appropriate field data items, instances, and/or fields are marked as deleted so that subsequent load or query operations will not return them. Later, a separate process cleans up, or \char`\"{}purges\char`\"{}, the marked-\/as-\/deleted data by going through the three-\/step process described above and, finally, removing deleted field and instance records.

Purging field data is made somewhat tricky by the fact that, while \hyperlink{group__field__attach_gac2e3658c9c02d0d0e71359f9ef2f207a}{field\_\-attach\_\-delete()} has a complete entity to pass to the various deletion hooks, the Field API purge process only has the field data it has previously stored. It cannot reconstruct complete original entities to pass to the deletion hooks. It is even possible that the original entity to which some Field API data was attached has been itself deleted before the field purge operation takes place.

Field API resolves this problem by using \char`\"{}pseudo-\/entities\char`\"{} during purge operations. A pseudo-\/entity contains only the information from the original entity that Field API knows about: entity type, id, revision id, and bundle. It also contains the field data for whichever field instance is currently being purged. For example, suppose that the node type 'story' used to contain a field called 'subtitle' but the field was deleted. If node 37 was a story with a subtitle, the pseudo-\/entity passed to the purge hooks would look something like this:


\begin{DoxyCode}
   $entity = stdClass Object(
     [nid] => 37,
     [vid] => 37,
     [type] => 'story',
     [subtitle] => array(
       [0] => array(
         'value' => 'subtitle text',
       ),
     ),
   );
\end{DoxyCode}


See \hyperlink{group__field}{Field API } for information about the other parts of the Field API. 

\subsection{Function Documentation}
\hypertarget{group__field__purge_gac0dcacb53338e25ac4e2add6b427757e}{
\index{field\_\-purge@{field\_\-purge}!field\_\-purge\_\-batch@{field\_\-purge\_\-batch}}
\index{field\_\-purge\_\-batch@{field\_\-purge\_\-batch}!field_purge@{field\_\-purge}}
\subsubsection[{field\_\-purge\_\-batch}]{\setlength{\rightskip}{0pt plus 5cm}field\_\-purge\_\-batch (\$ {\em batch\_\-size})}}
\label{group__field__purge_gac0dcacb53338e25ac4e2add6b427757e}
Purges a batch of deleted Field API data, instances, or fields.

This function will purge deleted field data in batches. The batch size is defined as an argument to the function, and once each batch is finished, it continues with the next batch until all have completed. If a deleted field instance with no remaining data records is found, the instance itself will be purged. If a deleted field with no remaining field instances is found, the field itself will be purged.


\begin{DoxyParams}{Parameters}
\item[{\em \$batch\_\-size}]The maximum number of field data records to purge before returning. \end{DoxyParams}
\hypertarget{group__field__purge_ga93ec2f273b56141a5079bfaf25d6b80e}{
\index{field\_\-purge@{field\_\-purge}!field\_\-purge\_\-data@{field\_\-purge\_\-data}}
\index{field\_\-purge\_\-data@{field\_\-purge\_\-data}!field_purge@{field\_\-purge}}
\subsubsection[{field\_\-purge\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}field\_\-purge\_\-data (\$ {\em entity\_\-type}, \/  \$ {\em entity}, \/  \$ {\em field}, \/  \$ {\em instance})}}
\label{group__field__purge_ga93ec2f273b56141a5079bfaf25d6b80e}
Purges the field data for a single field on a single pseudo-\/entity.

This is basically the same as \hyperlink{group__field__attach_gac2e3658c9c02d0d0e71359f9ef2f207a}{field\_\-attach\_\-delete()} except it only applies to a single field. The entity itself is not being deleted, and it is quite possible that other field data will remain attached to it.


\begin{DoxyParams}{Parameters}
\item[{\em \$entity\_\-type}]The type of \$entity; e.g. 'node' or 'user'. \item[{\em \$entity}]The pseudo-\/entity whose field data is being purged. \item[{\em \$field}]The (possibly deleted) field whose data is being purged. \item[{\em \$instance}]The deleted field instance whose data is being purged. \end{DoxyParams}
\hypertarget{group__field__purge_gac52122a65da997921f3a6a8f45deddbf}{
\index{field\_\-purge@{field\_\-purge}!field\_\-purge\_\-field@{field\_\-purge\_\-field}}
\index{field\_\-purge\_\-field@{field\_\-purge\_\-field}!field_purge@{field\_\-purge}}
\subsubsection[{field\_\-purge\_\-field}]{\setlength{\rightskip}{0pt plus 5cm}field\_\-purge\_\-field (\$ {\em field})}}
\label{group__field__purge_gac52122a65da997921f3a6a8f45deddbf}
Purges a field record from the database.

This function assumes all instances for the field has already been purged, and should only be called by \hyperlink{group__field__purge_gac0dcacb53338e25ac4e2add6b427757e}{field\_\-purge\_\-batch()}.


\begin{DoxyParams}{Parameters}
\item[{\em \$field}]The field record to purge. \end{DoxyParams}
\hypertarget{group__field__purge_ga766cee439c7c920d3d406c7af41c8968}{
\index{field\_\-purge@{field\_\-purge}!field\_\-purge\_\-instance@{field\_\-purge\_\-instance}}
\index{field\_\-purge\_\-instance@{field\_\-purge\_\-instance}!field_purge@{field\_\-purge}}
\subsubsection[{field\_\-purge\_\-instance}]{\setlength{\rightskip}{0pt plus 5cm}field\_\-purge\_\-instance (\$ {\em instance})}}
\label{group__field__purge_ga766cee439c7c920d3d406c7af41c8968}
Purges a field instance record from the database.

This function assumes all data for the instance has already been purged, and should only be called by \hyperlink{group__field__purge_gac0dcacb53338e25ac4e2add6b427757e}{field\_\-purge\_\-batch()}.


\begin{DoxyParams}{Parameters}
\item[{\em \$instance}]The instance record to purge. \end{DoxyParams}
