\hypertarget{classDatabaseLog}{
\section{DatabaseLog Class Reference}
\label{classDatabaseLog}\index{DatabaseLog@{DatabaseLog}}
}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classDatabaseLog_a4a73f612d4625189787c54ff361fd15e}{\_\-\_\-construct} (\$key= 'default')
\item 
\hyperlink{classDatabaseLog_a9e563dc89a838deefce998de656f4631}{start} (\$logging\_\-key)
\item 
\hyperlink{classDatabaseLog_a2fb927cb8c8ddee8819fba8333f6edca}{get} (\$logging\_\-key)
\item 
\hyperlink{classDatabaseLog_a26e486bc63ee0dcfbfb82401815500f6}{clear} (\$logging\_\-key)
\item 
\hyperlink{classDatabaseLog_a921215904c818b7e31fa5e24102eb0a2}{end} (\$logging\_\-key)
\item 
\hyperlink{classDatabaseLog_a1059d7d9b785b085e609add4c7cbb7f5}{log} (\hyperlink{interfaceDatabaseStatementInterface}{DatabaseStatementInterface} \$statement, \$args, \$time)
\item 
\hyperlink{classDatabaseLog_ae7b59ed8cd8e6163331d307db4531554}{findCaller} ()
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classDatabaseLog_a0046dd0598b8b8c1dcf73f49c887e68e}{
{\bfseries \$queryLog} = array()}
\label{classDatabaseLog_a0046dd0598b8b8c1dcf73f49c887e68e}

\item 
\hypertarget{classDatabaseLog_a4d944f9a5b64b6fa3403a8e15cec6703}{
{\bfseries \$connectionKey} = 'default'}
\label{classDatabaseLog_a4d944f9a5b64b6fa3403a8e15cec6703}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
\hyperlink{classDatabase}{Database} query logger.

We log queries in a separate object rather than in the connection object because we want to be able to see all queries sent to a given database, not database target. If we logged the queries in each connection object we would not be able to track what queries went to which target.

Every connection has one and only one logging object on it for all targets and logging keys. 

\subsection{Constructor \& Destructor Documentation}
\hypertarget{classDatabaseLog_a4a73f612d4625189787c54ff361fd15e}{
\index{DatabaseLog@{DatabaseLog}!\_\-\_\-construct@{\_\-\_\-construct}}
\index{\_\-\_\-construct@{\_\-\_\-construct}!DatabaseLog@{DatabaseLog}}
\subsubsection[{\_\-\_\-construct}]{\setlength{\rightskip}{0pt plus 5cm}DatabaseLog::\_\-\_\-construct (\$ {\em key} = {\ttfamily 'default'})}}
\label{classDatabaseLog_a4a73f612d4625189787c54ff361fd15e}
Constructor.


\begin{DoxyParams}{Parameters}
\item[{\em \$key}]The database connection key for which to enable logging. \end{DoxyParams}


\subsection{Member Function Documentation}
\hypertarget{classDatabaseLog_a26e486bc63ee0dcfbfb82401815500f6}{
\index{DatabaseLog@{DatabaseLog}!clear@{clear}}
\index{clear@{clear}!DatabaseLog@{DatabaseLog}}
\subsubsection[{clear}]{\setlength{\rightskip}{0pt plus 5cm}DatabaseLog::clear (\$ {\em logging\_\-key})}}
\label{classDatabaseLog_a26e486bc63ee0dcfbfb82401815500f6}
Empty the query log for the specified logging key.

This method does not stop logging, it simply clears the log. To stop logging, use the \hyperlink{classDatabaseLog_a921215904c818b7e31fa5e24102eb0a2}{end()} method.


\begin{DoxyParams}{Parameters}
\item[{\em \$logging\_\-key}]The logging key to empty. \end{DoxyParams}
\hypertarget{classDatabaseLog_a921215904c818b7e31fa5e24102eb0a2}{
\index{DatabaseLog@{DatabaseLog}!end@{end}}
\index{end@{end}!DatabaseLog@{DatabaseLog}}
\subsubsection[{end}]{\setlength{\rightskip}{0pt plus 5cm}DatabaseLog::end (\$ {\em logging\_\-key})}}
\label{classDatabaseLog_a921215904c818b7e31fa5e24102eb0a2}
Stop logging for the specified logging key.


\begin{DoxyParams}{Parameters}
\item[{\em \$logging\_\-key}]The logging key to stop. \end{DoxyParams}
\hypertarget{classDatabaseLog_ae7b59ed8cd8e6163331d307db4531554}{
\index{DatabaseLog@{DatabaseLog}!findCaller@{findCaller}}
\index{findCaller@{findCaller}!DatabaseLog@{DatabaseLog}}
\subsubsection[{findCaller}]{\setlength{\rightskip}{0pt plus 5cm}DatabaseLog::findCaller ()}}
\label{classDatabaseLog_ae7b59ed8cd8e6163331d307db4531554}
Determine the routine that called this query.

We define \char`\"{}the routine that called this query\char`\"{} as the first entry in the call stack that is not inside includes/database and does have a file (which excludes call\_\-user\_\-func\_\-array(), anonymous functions and similar). That makes the climbing logic very simple, and handles the variable stack depth caused by the query builders.

\hyperlink{}{This method returns a stack trace entry similar to that generated by debug\_\-backtrace(). However, it flattens the trace entry and the trace entry before it so that we get the function and args of the function that called into the database system, not the function and args of the database call itself. }\hypertarget{classDatabaseLog_a2fb927cb8c8ddee8819fba8333f6edca}{
\index{DatabaseLog@{DatabaseLog}!get@{get}}
\index{get@{get}!DatabaseLog@{DatabaseLog}}
\subsubsection[{get}]{\setlength{\rightskip}{0pt plus 5cm}DatabaseLog::get (\$ {\em logging\_\-key})}}
\label{classDatabaseLog_a2fb927cb8c8ddee8819fba8333f6edca}
Retrieve the query log for the specified logging key so far.


\begin{DoxyParams}{Parameters}
\item[{\em \$logging\_\-key}]The logging key to fetch. \end{DoxyParams}
\begin{DoxyReturn}{Returns}
An indexed array of all query records for this logging key. 
\end{DoxyReturn}
\hypertarget{classDatabaseLog_a1059d7d9b785b085e609add4c7cbb7f5}{
\index{DatabaseLog@{DatabaseLog}!log@{log}}
\index{log@{log}!DatabaseLog@{DatabaseLog}}
\subsubsection[{log}]{\setlength{\rightskip}{0pt plus 5cm}DatabaseLog::log ({\bf DatabaseStatementInterface} \$ {\em statement}, \/  \$ {\em args}, \/  \$ {\em time})}}
\label{classDatabaseLog_a1059d7d9b785b085e609add4c7cbb7f5}
Log a query to all active logging keys.


\begin{DoxyParams}{Parameters}
\item[{\em \$statement}]The prepared statement object to log. \item[{\em \$args}]The arguments passed to the statement object. \item[{\em \$time}]The time in milliseconds the query took to execute. \end{DoxyParams}
\hypertarget{classDatabaseLog_a9e563dc89a838deefce998de656f4631}{
\index{DatabaseLog@{DatabaseLog}!start@{start}}
\index{start@{start}!DatabaseLog@{DatabaseLog}}
\subsubsection[{start}]{\setlength{\rightskip}{0pt plus 5cm}DatabaseLog::start (\$ {\em logging\_\-key})}}
\label{classDatabaseLog_a9e563dc89a838deefce998de656f4631}
Begin logging queries to the specified connection and logging key.

If the specified logging key is already running this method does nothing.


\begin{DoxyParams}{Parameters}
\item[{\em \$logging\_\-key}]The identification key for this log request. By specifying different logging keys we are able to start and stop multiple logging runs simultaneously without them colliding. \end{DoxyParams}


The documentation for this class was generated from the following file:\begin{DoxyCompactItemize}
\item 
html/includes/database/\hyperlink{log_8inc}{log.inc}\end{DoxyCompactItemize}
