\hypertarget{group__sanitization}{
\section{Sanitization functions}
\label{group__sanitization}\index{Sanitization functions@{Sanitization functions}}
}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group__sanitization_ga46ff2822d576a77317f9045d65317b4f}{drupal\_\-strip\_\-dangerous\_\-protocols} (\$uri)
\item 
\hyperlink{group__sanitization_gac024315b69035ef05c33674838707919}{check\_\-url} (\$uri)
\item 
\hyperlink{group__sanitization_ga97dcceb77b76539219af2a85eacbe18d}{filter\_\-xss\_\-admin} (\$string)
\item 
\hyperlink{group__sanitization_ga8864a29ffa8de5c9f8dc9e417060660d}{filter\_\-xss} (\$string, \$allowed\_\-tags=array('a', 'em', 'strong', 'cite', 'blockquote', 'code', 'ul', 'ol', 'li', 'dl', 'dt', 'dd'))
\item 
\hyperlink{group__sanitization_ga1cc6cca885f021adcf11970b8ec4c846}{\_\-filter\_\-xss\_\-split} (\$m, \$store=FALSE)
\item 
\hyperlink{group__sanitization_ga3c24df8bdf07aa972dd82aa2ab35858f}{\_\-filter\_\-xss\_\-attributes} (\$attr)
\item 
\hyperlink{group__sanitization_ga81affabdadf9d999874d5a69316ec8c8}{filter\_\-xss\_\-bad\_\-protocol} (\$string, \$decode=TRUE)
\item 
\hyperlink{group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a}{drupal\_\-attributes} (array \$attributes=array())
\item 
\hyperlink{group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c}{st} (\$string, array \$args=array(), array \$options=array())
\item 
\hyperlink{group__sanitization_gaa3872d938cf9ba93ed0621a6b26eaa59}{check\_\-markup} (\$text, \$format\_\-id=NULL, \$langcode= '', \$cache=FALSE)
\end{DoxyCompactItemize}
\subsection*{into your string, and t() will}
\label{_amgrpc24520cd0c9d113d5113bfec581ba6b9}
 Translates a string to the current language or to a given language.

The t() function serves two purposes. First, at run-\/time it translates user-\/visible text into the appropriate language. Second, various mechanisms that figure out what text needs to be translated work off t() -\/-\/ the text inside t() calls is added to the database of strings to be translated. These strings are expected to be in English, so the first argument should always be in English. To enable a fully-\/translatable site, it is important that all human-\/readable text that will be displayed on the site or sent to a user is passed through the t() function, or a related function. See the \hyperlink{}{Localization API } pages for more information, including recommendations on how to break up or not break up strings for translation.\begin{DoxyCompactItemize}
\item 
\hyperlink{group__sanitization_ga8da272cf93fb6ba229eca7c0b06ea4d2}{format\_\-string} (\$string, array \$args=array())
\item 
\hyperlink{group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d}{check\_\-plain} (\$text)
\item 
\hyperlink{group__sanitization_gaa50232f577883a48731fc93530628a79}{get\_\-t} ()
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Functions to sanitize values.

See \href{http://drupal.org/writing-secure-code}{\tt http://drupal.org/writing-\/secure-\/code} for information on writing secure code. 

\subsection{Function Documentation}
\hypertarget{group__sanitization_ga3c24df8bdf07aa972dd82aa2ab35858f}{
\index{sanitization@{sanitization}!\_\-filter\_\-xss\_\-attributes@{\_\-filter\_\-xss\_\-attributes}}
\index{\_\-filter\_\-xss\_\-attributes@{\_\-filter\_\-xss\_\-attributes}!sanitization@{sanitization}}
\subsubsection[{\_\-filter\_\-xss\_\-attributes}]{\setlength{\rightskip}{0pt plus 5cm}\_\-filter\_\-xss\_\-attributes (\$ {\em attr})}}
\label{group__sanitization_ga3c24df8bdf07aa972dd82aa2ab35858f}
Processes a string of HTML attributes.

\begin{DoxyReturn}{Returns}
Cleaned up version of the HTML attributes. 
\end{DoxyReturn}
\hypertarget{group__sanitization_ga1cc6cca885f021adcf11970b8ec4c846}{
\index{sanitization@{sanitization}!\_\-filter\_\-xss\_\-split@{\_\-filter\_\-xss\_\-split}}
\index{\_\-filter\_\-xss\_\-split@{\_\-filter\_\-xss\_\-split}!sanitization@{sanitization}}
\subsubsection[{\_\-filter\_\-xss\_\-split}]{\setlength{\rightskip}{0pt plus 5cm}\_\-filter\_\-xss\_\-split (\$ {\em m}, \/  \$ {\em store} = {\ttfamily FALSE})}}
\label{group__sanitization_ga1cc6cca885f021adcf11970b8ec4c846}
Processes an HTML tag.


\begin{DoxyParams}{Parameters}
\item[{\em \$m}]An array with various meaning depending on the value of \$store. If \$store is TRUE then the array contains the allowed tags. If \$store is FALSE then the array has one element, the HTML tag to process. \item[{\em \$store}]Whether to store \$m.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
If the element isn't allowed, an empty string. Otherwise, the cleaned up version of the HTML element. 
\end{DoxyReturn}
\hypertarget{group__sanitization_gaa3872d938cf9ba93ed0621a6b26eaa59}{
\index{sanitization@{sanitization}!check\_\-markup@{check\_\-markup}}
\index{check\_\-markup@{check\_\-markup}!sanitization@{sanitization}}
\subsubsection[{check\_\-markup}]{\setlength{\rightskip}{0pt plus 5cm}check\_\-markup (\$ {\em text}, \/  \$ {\em format\_\-id} = {\ttfamily NULL}, \/  \$ {\em langcode} = {\ttfamily ''}, \/  \$ {\em cache} = {\ttfamily FALSE})}}
\label{group__sanitization_gaa3872d938cf9ba93ed0621a6b26eaa59}
Runs all the enabled filters on a piece of text.

Note: Because filters can inject JavaScript or execute PHP code, security is vital here. When a user supplies a text format, you should validate it using \hyperlink{filter_8module_aff74c90622b601df8e088f6b5c125bb7}{filter\_\-access()} before accepting/using it. This is normally done in the validation stage of the Form API. You should for example never make a preview of content in a disallowed format.


\begin{DoxyParams}{Parameters}
\item[{\em \$text}]The text to be filtered. \item[{\em \$format\_\-id}](optional) The format ID of the text to be filtered. If no format is assigned, the fallback format will be used. Defaults to NULL. \item[{\em \$langcode}](optional) The language code of the text to be filtered, e.g. 'en' for English. This allows filters to be language aware so language specific text replacement can be implemented. Defaults to an empty string. \item[{\em \$cache}](optional) A Boolean indicating whether to cache the filtered output in the \{cache\_\-filter\} table. The caller may set this to FALSE when the output is already cached elsewhere to avoid duplicate cache lookups and storage. Defaults to FALSE.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The filtered text. 
\end{DoxyReturn}
\hypertarget{group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d}{
\index{sanitization@{sanitization}!check\_\-plain@{check\_\-plain}}
\index{check\_\-plain@{check\_\-plain}!sanitization@{sanitization}}
\subsubsection[{check\_\-plain}]{\setlength{\rightskip}{0pt plus 5cm}check\_\-plain (\$ {\em text})}}
\label{group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d}
Encodes special characters in a plain-\/text string for display as HTML.

Also validates strings as UTF-\/8 to prevent cross site scripting attacks on Internet Explorer 6.


\begin{DoxyParams}{Parameters}
\item[{\em \$text}]The text to be checked or processed.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
An HTML safe version of \$text, or an empty string if \$text is not valid UTF-\/8.
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\hyperlink{bootstrap_8inc_abf62947a33393477301b0070b1ff0c7a}{drupal\_\-validate\_\-utf8()} 
\end{DoxySeeAlso}
\hypertarget{group__sanitization_gac024315b69035ef05c33674838707919}{
\index{sanitization@{sanitization}!check\_\-url@{check\_\-url}}
\index{check\_\-url@{check\_\-url}!sanitization@{sanitization}}
\subsubsection[{check\_\-url}]{\setlength{\rightskip}{0pt plus 5cm}check\_\-url (\$ {\em uri})}}
\label{group__sanitization_gac024315b69035ef05c33674838707919}
Strips dangerous protocols from a URI and encodes it for output to HTML.


\begin{DoxyParams}{Parameters}
\item[{\em \$uri}]A plain-\/text URI that might contain dangerous protocols.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A URI stripped of dangerous protocols and encoded for output to an HTML attribute value. Because it is already encoded, it should not be set as a value within a \$attributes array passed to \hyperlink{group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a}{drupal\_\-attributes()}, because \hyperlink{group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a}{drupal\_\-attributes()} expects those values to be plain-\/text strings. To pass a filtered URI to \hyperlink{group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a}{drupal\_\-attributes()}, call \hyperlink{group__sanitization_ga46ff2822d576a77317f9045d65317b4f}{drupal\_\-strip\_\-dangerous\_\-protocols()} instead.
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\hyperlink{group__sanitization_ga46ff2822d576a77317f9045d65317b4f}{drupal\_\-strip\_\-dangerous\_\-protocols()} 
\end{DoxySeeAlso}
\hypertarget{group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a}{
\index{sanitization@{sanitization}!drupal\_\-attributes@{drupal\_\-attributes}}
\index{drupal\_\-attributes@{drupal\_\-attributes}!sanitization@{sanitization}}
\subsubsection[{drupal\_\-attributes}]{\setlength{\rightskip}{0pt plus 5cm}drupal\_\-attributes (array \$ {\em attributes} = {\ttfamily array()})}}
\label{group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a}
Converts an associative array to an XML/HTML tag attribute string.

Each array key and its value will be formatted into an attribute string. If a value is itself an array, then its elements are concatenated to a single space-\/delimited string (for example, a class attribute with multiple values).

Attribute values are sanitized by running them through \hyperlink{group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d}{check\_\-plain()}. Attribute names are not automatically sanitized. When using user-\/supplied attribute names, it is strongly recommended to allow only white-\/listed names, since certain attributes carry security risks and can be abused.

Examples of security aspects when using drupal\_\-attributes: 
\begin{DoxyCode}
   // By running the value in the following statement through check_plain,
   // the malicious script is neutralized.
   drupal_attributes(array('title' => t('<script>steal_cookie();</script>')));

   // The statement below demonstrates dangerous use of drupal_attributes, and
   // will return an onmouseout attribute with JavaScript code that, when used
   // as attribute in a tag, will cause users to be redirected to another site.
   //
   // In this case, the 'onmouseout' attribute should not be whitelisted --
   // you don't want users to have the ability to add this attribute or others
   // that take JavaScript commands.
   drupal_attributes(array('onmouseout' => 'window.location="http://malicious.com
      /";')));
\end{DoxyCode}



\begin{DoxyParams}{Parameters}
\item[{\em \$attributes}]An associative array of key-\/value pairs to be converted to attributes.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A string ready for insertion in a tag (starts with a space). 
\end{DoxyReturn}
\hypertarget{group__sanitization_ga46ff2822d576a77317f9045d65317b4f}{
\index{sanitization@{sanitization}!drupal\_\-strip\_\-dangerous\_\-protocols@{drupal\_\-strip\_\-dangerous\_\-protocols}}
\index{drupal\_\-strip\_\-dangerous\_\-protocols@{drupal\_\-strip\_\-dangerous\_\-protocols}!sanitization@{sanitization}}
\subsubsection[{drupal\_\-strip\_\-dangerous\_\-protocols}]{\setlength{\rightskip}{0pt plus 5cm}drupal\_\-strip\_\-dangerous\_\-protocols (\$ {\em uri})}}
\label{group__sanitization_ga46ff2822d576a77317f9045d65317b4f}
Strips dangerous protocols (e.g. 'javascript:') from a URI.

This function must be called for all URIs within user-\/entered input prior to being output to an HTML attribute value. It is often called as part of \hyperlink{group__sanitization_gac024315b69035ef05c33674838707919}{check\_\-url()} or \hyperlink{group__sanitization_ga8864a29ffa8de5c9f8dc9e417060660d}{filter\_\-xss()}, but those functions return an HTML-\/encoded string, so this function can be called independently when the output needs to be a plain-\/text string for passing to t(), \hyperlink{common_8inc_ad3b36c06dc46250b8d22b8d0d2e7bd97}{l()}, \hyperlink{group__sanitization_gacf11629fb3d1ebf200863e2d15380b4a}{drupal\_\-attributes()}, or another function that will call \hyperlink{group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d}{check\_\-plain()} separately.


\begin{DoxyParams}{Parameters}
\item[{\em \$uri}]A plain-\/text URI that might contain dangerous protocols.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A plain-\/text URI stripped of dangerous protocols. As with all plain-\/text strings, this return value must not be output to an HTML page without \hyperlink{group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d}{check\_\-plain()} being called on it. However, it can be passed to functions expecting plain-\/text strings.
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\hyperlink{group__sanitization_gac024315b69035ef05c33674838707919}{check\_\-url()} 
\end{DoxySeeAlso}
\hypertarget{group__sanitization_ga8864a29ffa8de5c9f8dc9e417060660d}{
\index{sanitization@{sanitization}!filter\_\-xss@{filter\_\-xss}}
\index{filter\_\-xss@{filter\_\-xss}!sanitization@{sanitization}}
\subsubsection[{filter\_\-xss}]{\setlength{\rightskip}{0pt plus 5cm}filter\_\-xss (\$ {\em string}, \/  \$ {\em allowed\_\-tags} = {\ttfamily array('a',~'em',~'strong',~'cite',~'blockquote',~'code',~'ul',~'ol',~'li',~'dl',~'dt',~'dd')})}}
\label{group__sanitization_ga8864a29ffa8de5c9f8dc9e417060660d}
Filters HTML to prevent cross-\/site-\/scripting (XSS) vulnerabilities.

Based on kses by Ulf Harnhammar, see \href{http://sourceforge.net/projects/kses.}{\tt http://sourceforge.net/projects/kses.} For examples of various XSS attacks, see: \href{http://ha.ckers.org/xss.html.}{\tt http://ha.ckers.org/xss.html.}

This code does four things:
\begin{DoxyItemize}
\item Removes characters and constructs that can trick browsers.
\item Makes sure all HTML entities are well-\/formed.
\item Makes sure all HTML tags and attributes are well-\/formed.
\item Makes sure no HTML tags contain URLs with a disallowed protocol (e.g. javascript:).
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
\item[{\em \$string}]The string with raw HTML in it. It will be stripped of everything that can cause an XSS attack. \item[{\em \$allowed\_\-tags}]An array of allowed tags.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
An XSS safe version of \$string, or an empty string if \$string is not valid UTF-\/8.
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\hyperlink{bootstrap_8inc_abf62947a33393477301b0070b1ff0c7a}{drupal\_\-validate\_\-utf8()} 
\end{DoxySeeAlso}
\hypertarget{group__sanitization_ga97dcceb77b76539219af2a85eacbe18d}{
\index{sanitization@{sanitization}!filter\_\-xss\_\-admin@{filter\_\-xss\_\-admin}}
\index{filter\_\-xss\_\-admin@{filter\_\-xss\_\-admin}!sanitization@{sanitization}}
\subsubsection[{filter\_\-xss\_\-admin}]{\setlength{\rightskip}{0pt plus 5cm}filter\_\-xss\_\-admin (\$ {\em string})}}
\label{group__sanitization_ga97dcceb77b76539219af2a85eacbe18d}
Applies a very permissive XSS/HTML filter for admin-\/only use.

Use only for fields where it is impractical to use the whole filter system, but where some (mainly inline) mark-\/up is desired (so \hyperlink{group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d}{check\_\-plain()} is not acceptable).

Allows all tags that can be used inside an HTML body, save for scripts and styles. \hypertarget{group__sanitization_ga81affabdadf9d999874d5a69316ec8c8}{
\index{sanitization@{sanitization}!filter\_\-xss\_\-bad\_\-protocol@{filter\_\-xss\_\-bad\_\-protocol}}
\index{filter\_\-xss\_\-bad\_\-protocol@{filter\_\-xss\_\-bad\_\-protocol}!sanitization@{sanitization}}
\subsubsection[{filter\_\-xss\_\-bad\_\-protocol}]{\setlength{\rightskip}{0pt plus 5cm}filter\_\-xss\_\-bad\_\-protocol (\$ {\em string}, \/  \$ {\em decode} = {\ttfamily TRUE})}}
\label{group__sanitization_ga81affabdadf9d999874d5a69316ec8c8}
Processes an HTML attribute value and strips dangerous protocols from URLs.


\begin{DoxyParams}{Parameters}
\item[{\em \$string}]The string with the attribute value. \item[{\em \$decode}](deprecated) Whether to decode entities in the \$string. Set to FALSE if the \$string is in plain text, TRUE otherwise. Defaults to TRUE. This parameter is deprecated and will be removed in Drupal 8. To process a plain-\/text URI, call \hyperlink{group__sanitization_ga46ff2822d576a77317f9045d65317b4f}{drupal\_\-strip\_\-dangerous\_\-protocols()} or \hyperlink{group__sanitization_gac024315b69035ef05c33674838707919}{check\_\-url()} instead.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Cleaned up and HTML-\/escaped version of \$string. 
\end{DoxyReturn}
\hypertarget{group__sanitization_ga8da272cf93fb6ba229eca7c0b06ea4d2}{
\index{sanitization@{sanitization}!format\_\-string@{format\_\-string}}
\index{format\_\-string@{format\_\-string}!sanitization@{sanitization}}
\subsubsection[{format\_\-string}]{\setlength{\rightskip}{0pt plus 5cm}format\_\-string (\$ {\em string}, \/  array \$ {\em args} = {\ttfamily array()})}}
\label{group__sanitization_ga8da272cf93fb6ba229eca7c0b06ea4d2}
Formats a string for HTML display by replacing variable placeholders.

This function replaces variable placeholders in a string with the requested values and escapes the values so they can be safely displayed as HTML. It should be used on any unknown text that is intended to be printed to an HTML page (especially text that may have come from untrusted users, since in that case it prevents cross-\/site scripting and other security problems).

In most cases, you should use t() rather than calling this function directly, since it will translate the text (on non-\/English-\/only sites) in addition to formatting it.


\begin{DoxyParams}{Parameters}
\item[{\em \$string}]A string containing placeholders. \item[{\em \$args}]An associative array of replacements to make. Occurrences in \$string of any key in \$args are replaced with the corresponding value, after optional sanitization and formatting. The type of sanitization and formatting depends on the first character of the key:
\begin{DoxyItemize}
\item : Escaped to HTML using \hyperlink{group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d}{check\_\-plain()}. Use this as the default choice for anything displayed on a page on the site.
\item variable: Escaped to HTML and formatted using \hyperlink{group__schemaapi_ga4ab49ad51d8b93bb296a8492296d655b}{drupal\_\-placeholder()}, which makes it display as {\itshape emphasized\/} text.
\item !variable: Inserted as is, with no sanitization or formatting. Only use this for text that has already been prepared for HTML display (for example, user-\/supplied text that has already been run through \hyperlink{group__sanitization_ga76fc67a30fd8d75ddd80565e6e65a13d}{check\_\-plain()} previously, or is expected to contain some limited HTML tags and has already been run through \hyperlink{group__sanitization_ga8864a29ffa8de5c9f8dc9e417060660d}{filter\_\-xss()} previously).
\end{DoxyItemize}\end{DoxyParams}
\begin{DoxySeeAlso}{See also}
t() 
\end{DoxySeeAlso}
\hypertarget{group__sanitization_gaa50232f577883a48731fc93530628a79}{
\index{sanitization@{sanitization}!get\_\-t@{get\_\-t}}
\index{get\_\-t@{get\_\-t}!sanitization@{sanitization}}
\subsubsection[{get\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}get\_\-t ()}}
\label{group__sanitization_gaa50232f577883a48731fc93530628a79}
Returns the name of the proper localization function.

\hyperlink{group__sanitization_gaa50232f577883a48731fc93530628a79}{get\_\-t()} exists to support localization for code that might run during the installation phase, when some elements of the system might not have loaded.

This would include implementations of \hyperlink{group__hooks_ga1ecdb5a2a046ea63dc790c3ed90338e5}{hook\_\-install()}, which could run during the Drupal installation phase, and might also be run during non-\/installation time, such as while installing the module from the the module administration page.

Example usage: 
\begin{DoxyCode}
   $t = get_t();
   $translated = $t('translate this');
\end{DoxyCode}


Use t() if your code will never run during the Drupal installation phase. Use \hyperlink{group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c}{st()} if your code will only run during installation and never any other time. Use \hyperlink{group__sanitization_gaa50232f577883a48731fc93530628a79}{get\_\-t()} if your code could run in either circumstance.

\begin{DoxySeeAlso}{See also}
t() 

\hyperlink{group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c}{st()} 
\end{DoxySeeAlso}
\hypertarget{group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c}{
\index{sanitization@{sanitization}!st@{st}}
\index{st@{st}!sanitization@{sanitization}}
\subsubsection[{st}]{\setlength{\rightskip}{0pt plus 5cm}st (\$ {\em string}, \/  array \$ {\em args} = {\ttfamily array()}, \/  array \$ {\em options} = {\ttfamily array()})}}
\label{group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c}
Translates a string when some systems are not available.

Used during the install process, when database, theme, and localization system is possibly not yet available.

Use t() if your code will never run during the Drupal installation phase. Use \hyperlink{group__sanitization_gabc78d1b88aa8081093abbbf71a516c7c}{st()} if your code will only run during installation and never any other time. Use \hyperlink{group__sanitization_gaa50232f577883a48731fc93530628a79}{get\_\-t()} if your code could run in either circumstance.

\begin{DoxySeeAlso}{See also}
t() 

\hyperlink{group__sanitization_gaa50232f577883a48731fc93530628a79}{get\_\-t()} 
\end{DoxySeeAlso}
