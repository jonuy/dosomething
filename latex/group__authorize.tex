\hypertarget{group__authorize}{
\section{Authorized operations}
\label{group__authorize}\index{Authorized operations@{Authorized operations}}
}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group__authorize_ga17756b29805705dbea25798d6004d5dd}{system\_\-authorized\_\-init} (\$callback, \$file, \$arguments=array(), \$page\_\-title=NULL)
\item 
\hyperlink{group__authorize_gab59393fbd369097724650dec4be9c1dd}{system\_\-authorized\_\-get\_\-url} (array \$options=array())
\item 
\hyperlink{group__authorize_gae4eeb93b25a44e4280535f21ed0a0c78}{system\_\-authorized\_\-batch\_\-processing\_\-url} ()
\item 
\hyperlink{group__authorize_gae12fb581acdf9ef042c9137fc6de4d4c}{system\_\-authorized\_\-run} (\$callback, \$file, \$arguments=array(), \$page\_\-title=NULL)
\item 
\hyperlink{group__authorize_ga049418587e2e337a471f3b707d501196}{system\_\-authorized\_\-batch\_\-process} ()
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Functions to run operations with elevated privileges via \hyperlink{authorize_8php}{authorize.php}.

Because of the Update manager functionality included in Drupal core, there is a mechanism for running operations with elevated file system privileges, the top-\/level \hyperlink{authorize_8php}{authorize.php} script. This script runs at a reduced Drupal bootstrap level so that it is not reliant on the entire site being functional. The operations use a \hyperlink{classFileTransfer}{FileTransfer} class to manipulate code installed on the system as the user that owns the files, not the user that the httpd is running as.

The first setup is to define a callback function that should be authorized to run with the elevated privileges. This callback should take a \hyperlink{classFileTransfer}{FileTransfer} as its first argument, although you can define an array of other arguments it should be invoked with. The callback should be placed in a separate .inc file that will be included by \hyperlink{authorize_8php}{authorize.php}.

To run the operation, certain data must be saved into the SESSION, and then the flow of control should be redirected to the \hyperlink{authorize_8php}{authorize.php} script. There are two ways to do this, either to call \hyperlink{group__authorize_gae12fb581acdf9ef042c9137fc6de4d4c}{system\_\-authorized\_\-run()} directly, or to call \hyperlink{group__authorize_ga17756b29805705dbea25798d6004d5dd}{system\_\-authorized\_\-init()} and then redirect to \hyperlink{authorize_8php}{authorize.php}, using the URL from \hyperlink{group__authorize_gab59393fbd369097724650dec4be9c1dd}{system\_\-authorized\_\-get\_\-url()}. Redirecting yourself is necessary when your authorized operation is being triggered by a form submit handler, since calling \hyperlink{group__http__handling_ga5b68d7a934713d1d623b2b32a732235d}{drupal\_\-goto()} in a submit handler is a bad idea, and you should instead set \$form\_\-state\mbox{[}'redirect'\mbox{]}.

Once the SESSION is setup for the operation and the user is redirected to \hyperlink{authorize_8php}{authorize.php}, they will be prompted for their connection credentials (core provides FTP and SSH by default, although other connection classes can be added via contributed modules). With valid credentials, \hyperlink{authorize_8php}{authorize.php} will instantiate the appropriate \hyperlink{classFileTransfer}{FileTransfer} object, and then invoke the desired operation passing in that object. The \hyperlink{authorize_8php}{authorize.php} script can act as a Batch API processing page, if the operation requires a batch.

\begin{DoxySeeAlso}{See also}
\hyperlink{authorize_8php}{authorize.php} 

\hyperlink{classFileTransfer}{FileTransfer} 

\hyperlink{group__hooks_gacecdedb61704444382417e6ec8da240d}{hook\_\-filetransfer\_\-info()} 
\end{DoxySeeAlso}


\subsection{Function Documentation}
\hypertarget{group__authorize_ga049418587e2e337a471f3b707d501196}{
\index{authorize@{authorize}!system\_\-authorized\_\-batch\_\-process@{system\_\-authorized\_\-batch\_\-process}}
\index{system\_\-authorized\_\-batch\_\-process@{system\_\-authorized\_\-batch\_\-process}!authorize@{authorize}}
\subsubsection[{system\_\-authorized\_\-batch\_\-process}]{\setlength{\rightskip}{0pt plus 5cm}system\_\-authorized\_\-batch\_\-process ()}}
\label{group__authorize_ga049418587e2e337a471f3b707d501196}
Use \hyperlink{authorize_8php}{authorize.php} to run \hyperlink{group__batch_gab17f59692632a482cee4f65f27d082f7}{batch\_\-process()}.

\begin{DoxySeeAlso}{See also}
\hyperlink{group__batch_gab17f59692632a482cee4f65f27d082f7}{batch\_\-process()} 
\end{DoxySeeAlso}
\hypertarget{group__authorize_gae4eeb93b25a44e4280535f21ed0a0c78}{
\index{authorize@{authorize}!system\_\-authorized\_\-batch\_\-processing\_\-url@{system\_\-authorized\_\-batch\_\-processing\_\-url}}
\index{system\_\-authorized\_\-batch\_\-processing\_\-url@{system\_\-authorized\_\-batch\_\-processing\_\-url}!authorize@{authorize}}
\subsubsection[{system\_\-authorized\_\-batch\_\-processing\_\-url}]{\setlength{\rightskip}{0pt plus 5cm}system\_\-authorized\_\-batch\_\-processing\_\-url ()}}
\label{group__authorize_gae4eeb93b25a44e4280535f21ed0a0c78}
Returns the URL for the \hyperlink{authorize_8php}{authorize.php} script when it is processing a batch. \hypertarget{group__authorize_gab59393fbd369097724650dec4be9c1dd}{
\index{authorize@{authorize}!system\_\-authorized\_\-get\_\-url@{system\_\-authorized\_\-get\_\-url}}
\index{system\_\-authorized\_\-get\_\-url@{system\_\-authorized\_\-get\_\-url}!authorize@{authorize}}
\subsubsection[{system\_\-authorized\_\-get\_\-url}]{\setlength{\rightskip}{0pt plus 5cm}system\_\-authorized\_\-get\_\-url (array \$ {\em options} = {\ttfamily array()})}}
\label{group__authorize_gab59393fbd369097724650dec4be9c1dd}
Return the URL for the \hyperlink{authorize_8php}{authorize.php} script.


\begin{DoxyParams}{Parameters}
\item[{\em array}]\$options Optional array of options to pass to \hyperlink{common_8inc_a43b2a0594431556db49df980801d8807}{url()}. \end{DoxyParams}
\begin{DoxyReturn}{Returns}
The full URL to \hyperlink{authorize_8php}{authorize.php}, using HTTPS if available.
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\hyperlink{group__authorize_ga17756b29805705dbea25798d6004d5dd}{system\_\-authorized\_\-init()} 
\end{DoxySeeAlso}
\hypertarget{group__authorize_ga17756b29805705dbea25798d6004d5dd}{
\index{authorize@{authorize}!system\_\-authorized\_\-init@{system\_\-authorized\_\-init}}
\index{system\_\-authorized\_\-init@{system\_\-authorized\_\-init}!authorize@{authorize}}
\subsubsection[{system\_\-authorized\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}system\_\-authorized\_\-init (\$ {\em callback}, \/  \$ {\em file}, \/  \$ {\em arguments} = {\ttfamily array()}, \/  \$ {\em page\_\-title} = {\ttfamily NULL})}}
\label{group__authorize_ga17756b29805705dbea25798d6004d5dd}
Setup a given callback to run via \hyperlink{authorize_8php}{authorize.php} with elevated privileges.

To use \hyperlink{authorize_8php}{authorize.php}, certain variables must be stashed into \$\_\-SESSION. This function sets up all the necessary \$\_\-SESSION variables. The calling function should then redirect to \hyperlink{authorize_8php}{authorize.php}, using the full path returned by \hyperlink{group__authorize_gab59393fbd369097724650dec4be9c1dd}{system\_\-authorized\_\-get\_\-url()}. That initiates the workflow that will eventually lead to the callback being invoked. The callback will be invoked at a low bootstrap level, without all modules being invoked, so it needs to be careful not to assume any code exists. Example (\hyperlink{group__authorize_gae12fb581acdf9ef042c9137fc6de4d4c}{system\_\-authorized\_\-run()}): 
\begin{DoxyCode}
   system_authorized_init($callback, $file, $arguments, $page_title);
   drupal_goto(system_authorized_get_url());
\end{DoxyCode}
 Example (\hyperlink{group__update__manager__install_ga52e9f2cddddddccf921284b01f9505b0}{update\_\-manager\_\-install\_\-form\_\-submit()}): 
\begin{DoxyCode}
  system_authorized_init('update_authorize_run_install',
    drupal_get_path('module', 'update') . '/update.authorize.inc',
    $arguments, t('Update manager'));
  $form_state['redirect'] = system_authorized_get_url();
\end{DoxyCode}



\begin{DoxyParams}{Parameters}
\item[{\em \$callback}]The name of the function to invoke once the user authorizes the operation. \item[{\em \$file}]The full path to the file where the callback function is implemented. \item[{\em \$arguments}]Optional array of arguments to pass into the callback when it is invoked. Note that the first argument to the callback is always the \hyperlink{classFileTransfer}{FileTransfer} object created by \hyperlink{authorize_8php}{authorize.php} when the user authorizes the operation. \item[{\em \$page\_\-title}]Optional string to use as the page title once redirected to \hyperlink{authorize_8php}{authorize.php}. \end{DoxyParams}
\begin{DoxyReturn}{Returns}
Nothing, this function just initializes variables in the user's session. 
\end{DoxyReturn}
\hypertarget{group__authorize_gae12fb581acdf9ef042c9137fc6de4d4c}{
\index{authorize@{authorize}!system\_\-authorized\_\-run@{system\_\-authorized\_\-run}}
\index{system\_\-authorized\_\-run@{system\_\-authorized\_\-run}!authorize@{authorize}}
\subsubsection[{system\_\-authorized\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}system\_\-authorized\_\-run (\$ {\em callback}, \/  \$ {\em file}, \/  \$ {\em arguments} = {\ttfamily array()}, \/  \$ {\em page\_\-title} = {\ttfamily NULL})}}
\label{group__authorize_gae12fb581acdf9ef042c9137fc6de4d4c}
Setup and invoke an operation using \hyperlink{authorize_8php}{authorize.php}.

\begin{DoxySeeAlso}{See also}
\hyperlink{group__authorize_ga17756b29805705dbea25798d6004d5dd}{system\_\-authorized\_\-init()} 
\end{DoxySeeAlso}
