<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>DoSomething.org: Private update status cache system</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Private update status cache system</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__update__status__cache.html#ga3610ff1515f81f28c69b019e5482b77b">_update_cache_set</a> ($cid, $data, $expire)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__update__status__cache.html#ga3f305bb51be069556fa20d692e286f40">_update_cache_get</a> ($cid)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__update__status__cache.html#ga11c5e3cca6cd9eb1dc328f757448885f">_update_get_cache_multiple</a> ($cid_prefix)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__update__status__cache.html#ga45fc31b5f9949fc0081ed148a9f378dd">_update_cache_clear</a> ($cid=NULL, $wildcard=FALSE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__update__status__cache.html#ga9c94b82fd5dfa8483267b9af6042bbb2">update_flush_caches</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Functions to manage the update status cache.</p>
<p>We specifically do NOT use the core cache API for saving the fetched data about available updates. It is vitally important that this cache is only cleared when we're populating it after successfully fetching new available update data. Usage of the core cache API results in all sorts of potential problems that would result in attempting to fetch available update data all the time, including if a site has a "minimum cache lifetime" (which is both a minimum and a maximum) defined, or if a site uses memcache or another pluggable cache system that assumes volatile caches.</p>
<p>The Update Manager module still uses the {cache_update} table, but instead of using <a class="el" href="includes_2cache_8inc.html#a48081f36334909f561ef4f538fa640d2">cache_set()</a>, <a class="el" href="includes_2cache_8inc.html#a9d873815c28909b61c3a6188b383f8a3">cache_get()</a>, and <a class="el" href="includes_2cache_8inc.html#a409b34dd629640d791a11736a9de8125">cache_clear_all()</a>, there are private helper functions that implement these same basic tasks but ensure that the cache is not prematurely cleared, and that the data is always stored in the database, even if memcache or another cache backend is in use. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga45fc31b5f9949fc0081ed148a9f378dd"></a><!-- doxytag: member="update.module::_update_cache_clear" ref="ga45fc31b5f9949fc0081ed148a9f378dd" args="($cid=NULL, $wildcard=FALSE)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_update_cache_clear </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>cid</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>wildcard</em> = <code>FALSE</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Invalidates cached data relating to update status.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$cid</em>&nbsp;</td><td>(optional) Cache ID of the record to clear from the private update module cache. If empty, all records will be cleared from the table except fetch tasks. Defaults to NULL. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$wildcard</em>&nbsp;</td><td>(optional) If TRUE, cache IDs starting with $cid are deleted in addition to the exact cache ID specified by $cid. Defaults to FALSE. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga3f305bb51be069556fa20d692e286f40"></a><!-- doxytag: member="update.module::_update_cache_get" ref="ga3f305bb51be069556fa20d692e286f40" args="($cid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_update_cache_get </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>cid</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Retrieves data from the private update status cache table.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$cid</em>&nbsp;</td><td>The cache ID to retrieve.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>An array of data for the given cache ID, or NULL if the ID was not found.</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__update__status__cache.html#ga3610ff1515f81f28c69b019e5482b77b">_update_cache_set()</a> </dd></dl>

</div>
</div>
<a class="anchor" id="ga3610ff1515f81f28c69b019e5482b77b"></a><!-- doxytag: member="update.module::_update_cache_set" ref="ga3610ff1515f81f28c69b019e5482b77b" args="($cid, $data, $expire)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_update_cache_set </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>cid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>expire</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Stores data in the private update status cache table.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$cid</em>&nbsp;</td><td>The cache ID to save the data with. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$data</em>&nbsp;</td><td>The data to store. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$expire</em>&nbsp;</td><td>One of the following values:</p>
<ul>
<li>CACHE_PERMANENT: Indicates that the item should never be removed except by explicitly using <a class="el" href="group__update__status__cache.html#ga45fc31b5f9949fc0081ed148a9f378dd">_update_cache_clear()</a>.</li>
<li>A Unix timestamp: Indicates that the item should be kept at least until the given time, after which it will be invalidated.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__update__status__cache.html#ga3f305bb51be069556fa20d692e286f40">_update_cache_get()</a> </dd></dl>

</div>
</div>
<a class="anchor" id="ga11c5e3cca6cd9eb1dc328f757448885f"></a><!-- doxytag: member="update.module::_update_get_cache_multiple" ref="ga11c5e3cca6cd9eb1dc328f757448885f" args="($cid_prefix)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_update_get_cache_multiple </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>cid_prefix</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Returns an array of cache items with a given cache ID prefix.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>string</em>&nbsp;</td><td>$cid_prefix The cache ID prefix.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Associative array of cache items, keyed by cache ID. </dd></dl>

</div>
</div>
<a class="anchor" id="ga9c94b82fd5dfa8483267b9af6042bbb2"></a><!-- doxytag: member="update.module::update_flush_caches" ref="ga9c94b82fd5dfa8483267b9af6042bbb2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">update_flush_caches </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Implements <a class="el" href="group__hooks.html#ga66531e6e564157b7ca45ed07549c9b97">hook_flush_caches()</a>.</p>
<p>Called from <a class="el" href="update_8php.html">update.php</a> (among others) to flush the caches. Since we're running <a class="el" href="update_8php.html">update.php</a>, we are likely to install a new version of something, in which case, we want to check for available update data again. However, because we have our own caching system, we need to directly clear the database table ourselves at this point and return nothing, for example, on sites that use memcache where <a class="el" href="includes_2cache_8inc.html#a409b34dd629640d791a11736a9de8125">cache_clear_all()</a> won't know how to purge this data.</p>
<p>However, we only want to do this from <a class="el" href="update_8php.html">update.php</a>, since otherwise, we'd lose all the available update data on every cron run. So, we specifically check if the site is in MAINTENANCE_MODE == 'update' (which indicates <a class="el" href="update_8php.html">update.php</a> is running, not update module... alas for overloaded names). </p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 8 Nov 2013 for DoSomething.org by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
